---
order: 5
icon: ri:game-fill
---

# 통합전략 스키마

::: tip
주의: JSON 형식은 주석을 지원하지 않으므로 아래의 예시에서 주석은 제거해주시기 바랍니다.
:::

## 로그라이크 리소스 파일 위치

- `resource/roguelike/`아래에 테마별 로그라이크 작업의 리소스를 저장합니다.
  - 테마 폴더: `Phantom/` 팬텀 로그라이크, `Mizuki/` 미즈키 로그라이크,`Sami/` 사미 로그라이크.
    - `autopilot/` 내에는 각 레벨의 작전 json이 있습니다.
      - `关卡名.json` 레벨의 작전 로직
    - `encounter/` 우연한 만남의 로직
      - `default.json` 기본 로직
      - `deposit.json` 예금 로직
    - `recruitment.json` 오퍼레이터 모집 로직
    - `shopping.json` 상점 구매 로직

- 특히 `Sami/` 아래의
  - `foldartal.json`은 사미 로그라이크 암호판의 사용 로직을 나타냅니다
  - `collapsal_paradigms.json`은 사미 로그라이크 붕괴 패러다임의 유형을 나타냅니다
  - `autopilot/레벨이름_collapse.json`은 레벨의 전투 로직(붕괴 패러다임 모드 반복)을 나타냅니다
  - `encounter/collapse.json`은 붕괴 패러다임 모드 우연한 만남의 로직을 나타냅니다

## 로그라이크 첫 단계 - 오퍼레이터 모집

`resource/roguelike/主题名/recruitment.json` 은 오퍼레이터 모집의 로직을 설명합니다.
`tools/RoguelikeRecruitmentTool`과 `tools/RoguelikeOperSearch`에는 보기와 작성을 돕는 서포터 도구가 있습니다.

```json
{
    "theme": "Phantom",              //로그라이크 테마 (팬텀)
    "priority": [                    //그룹의 우선순위, 순서대로
             ...
        ],
    "team_complete_condition": [     //팀의 완성도 검사
             ...
        ]
}
```

### 오퍼레이터 분류

게임 이해에 따라 오퍼레이터를 다양한 **_groups_** (관련 개념은 [전투 스키마](./copilot-schema.md)를 참고)으로 분류합니다

::: info 주의

1. 같은 그룹 내의 오퍼레이터와 소환물은 배치 방식이 일치해야 합니다(즉, 근접이거나 원거리로 동일).

2. 같은 오퍼레이터나 소환물을 다르게 사용할 수 있게 다른 그룹으로 분류할 수 있습니다.

3. 기존의 그룹 이름을 수정하지 마세요. MAA 업데이트 시 이전 버전의 작업을 사용할 수 없게 될 수 있습니다.

4. 새로운 그룹을 가능한 한 추가하지 마시고, 새로 추가하는 단위를 기존 그룹에 편입시키세요.
   :::

::: tip
기본적으로 1정 55레벨 이상의 오퍼레이터만 모집합니다.
:::

```json
{
    "theme": "Phantom",
    "priority": [                     // 그룹, 순서대로
        {
            "name": "棘刺",           // 그룹 이름(이 그룹 이름은 쏜즈)
            "opers": [                // 그룹에 포함된 오퍼레이터, 순서대로, 오퍼레이터 배치 시 우선순위 표시,
                                      // (예를 들어 이 그룹의 오퍼레이터를 배치할 때, 먼저 가시가 있는지 확인하고, 가시가 있으면 가시를 배치하고, 없으면 다음 오퍼레이터를 확인)
                {
                    "name": "棘刺",   // 오퍼레이터 이름
                    ...
                },
                {
                    "name": "号角",
                    ...
                }
            ]
        },
       "team_complete_condition": [
             ...
        ]
    ]
}
```

1. 기존 그룹 소개

    사미 로그라이크의 작전을 예로 들면: 주로 오퍼레이터를 다음과 같이 분류합니다
    | 그룹 | 주요 고려사항 | 주로 포함된 직업 | 예시 오퍼레이터 |  
    | :--- | :--- | :--- | :--- |
    | **_지상 저지_** (地面阻挡) | 현장 유지와 잡몹 처리 | 디펜더, 가드 |라 플루마, 마운틴, 몬3터, 링과 씬의 소환물, 스팟, 디펜더 예비 인원 |
    | **_지상 단일 타겟/처형자_** (地面单切/处决者) | 엘리트 적과 단독 전투 | 처형자 특수 | 수르트, 키린R 야토, 몬3터, 레드 |
    | **_고지대 C_** (高台 C) | 일반 및 결전 딜러 | 명사수, 캐스터 | Wiš'adel, 로고스, 첸 더 홀룽데이, 골든글로우 |
    | **_고지대 딜러_** (高台输出) | 대공 및 일반 딜러 | 명사수, 캐스터 | 아르케토, 엑시아, 크루스, 스튜어드 |
    | **_속사 저격_** (速狙) | 물리 딜러, 표준 사거리 | 명사수 | 아르케토, 엑시아, 메이, 크루스 |
    | **_캐스터_** (术师) | 마법 딜러, 표준 사거리 | 단일 마법 | 에이야퍄들라, 로고스, 스튜어트 |
    | **_서포터_** (辅助) | 뒤 1칸까지 공격 가능 | 서포터 | 비르투오사, 수즈란, 메이, 오키드 |
    | **_명사수_** (狙击) | 사거리가 긴 고지대 | 투척수, 공성수 | Wiš'adel, 티폰, 로즈몬티스 |
    | **_힐러_** (奶) | 치유 능력 | 힐러, 서포터 | 켈시, 스카디 더 커럽팅 하트, 히비스커스, 안셀 |
    | **_단일 힐러_** (单奶) | 공격 범위>=4 | 힐러 | 켈시, 나이팅게일, 이프리트, 히비스커스, 안셀 |
    | **_광역 힐러_** (群奶) | 공격 범위<4, 뒤쪽도 힐 가능 | 힐러, 서포터 | 나이팅게일, 프틸롭시스, 스카디 더 커럽팅 하트 |
    | **_코스트 회복_** (回费) | 코스트 회복 | 뱅가드 | 머틀, 이네스, 팽, 바닐라 |
    | **_매복자_** (地刺) | 저지 없이 탱커 앞에서 딜 또는 감속 제공 | 매복수 | 글래디아, 아스카론, 맨티코어 |
    | **_지상 원거리_** (地面远程) | 지상 장거리, 탱커 뒤에서 딜 가능 | 교관, 로드 | 혼, 팔라스, 실버애쉬 |
    | **_로드_** (领主) | 지상 공격 범위 종심>4, 대공 가능 | 포트리스, 로드 | 솜, 실버애쉬, 추백 |
    | **_진법 술사_** (盾法) | 공격 범위 짧음, 일정 탱킹 능력 있음 | 진법 술사 | 린, 카넬리안 |
    | **_캐논 포더_** (炮灰) | 포탄 흡수, 재배치 | 특수, 소환물 | M3, 레드, 머틀, 예비 오퍼레이터 |
    | **_대용 탱커_** (大龙) | 탱커 앞 탱킹, 저지 근처에 배치하여 합체 용이 | 소환물 | 링의 소환물, 제시카의 방패 |
    | **_보급 스테이션_** (补给站) | 주력 C 오퍼레이터의 회전 가속 | 소환물 | 지원 보급 스테이션, 공작 계열 오퍼레이터의 소환물 |
    | **_드론_** (无人机) | 고지대/지상 구분 없는 치유 소환물 | 소환물 | 스카디의 소환물, 사일런스의 드론 |
    | **_지원 트랩_** (支援陷阱) | 지상에 배치하는 폭발물 | 소환물 | 지원 안개기, 지원 폭발기 |
    | **_장애물_** (障碍物) | 배치 위치를 차지하지 않고 어그로 유도 또는 저지 | 소환물 | 새장, 장애물 |
    | **_기타 지상_** (其他地面) | 우선 사용을 원치 않는 지상 유닛 | 밀치기/당기기, 1블록 선봉, 검호 | 백파이프, 크루아상 |
    | **_고지대 예비/기타 고지대_** (高台预备/其他高台) | 우선 사용을 원치 않는 고지대 유닛 | 광역 캐스터, 체인 캐스터, 전술가 | 오키드, 예비 오퍼레이터 |

    ::: tip
    지상 저지(地面阻挡)은 주로 오퍼레이터의 종합적인 방어 능력을 고려합니다. (때로는 모두 처치하는 것도 강력한 방어의 표현이죠) 여기에는 지상 원거리와 로드 그룹도 포함됩니다.

    힐러(奶)는 주로 종합적인 치유 능력을 고려하며, 단일 힐러와 광역 힐러를 포함합니다. 공격 범위 커버를 고려할 때는 단일 힐러(4칸 치유)나 광역 힐러(뒤쪽 치유)를 단독으로 사용해야 할 수도 있습니다.

    고지대 딜러(高台输出)는 오직 딜 능력만 고려하며, 주로 명사수와 캐스터 직업이 혼합 정렬됩니다. 딜 타입, 공격 범위 등의 제한 조건을 고려해야 할 때는 명사수, 캐스터, 서포터, 진법 술사를 단독으로 사용해야 합니다.

    집게 형태의 소환물은 수가 많기 때문에 지원 트랩에 넣지 말고, MAA가 자동으로 배치하게 하는 것이 더 좋은 효과를 냅니다.
    :::

2. 특별 취급이 필요한 그룹

    위의 일반적인 그룹 외에도, 때로는 일부 오퍼레이터나 오퍼레이터 유형에 대해 맞춤형 세부 조작이 필요합니다. 예를 들면:
    | 그룹 | 포함 오퍼레이터 | 주요 특징 |
    | :--- | :--- | :--- |
    | Wiš'adel(益达) | Wiš'adel | 고지대 딜러, 우선 배치로 압박 완화 가능 |
    | 쏜즈(棘刺) | 쏜, 호른 | 지상 원거리 딜러, 팬텀 로그라이크에서 일부 맵에 매우 적합한 위치 존재 |
    | 소환(召唤类) | 켈시, 링, 시온 | 자체 지상 저지 능력, 일부 맵에서 우선 배치 필요, 소환물은 저지용 또는 캐논 포더로 사용 가능 |
    | 에이전트(情报官) | 샤오, 이네스 | 비용 회복, 측면 딜링, 단일 타겟 처리 모두 가능 |
    | 스카디 더 커럽팅 하트(浊心斯卡蒂) | 스카디 더 커럽팅 하트 | 낮은 압박 시 치유량 적당, 특수한 범위, 일부 맵에 적합한 위치 존재 |
    | 리드 더 플레임 쉐도우(焰苇) | 리드 더 플레임 쉐도우 | 사미 로그라이크에서 자주 사용되는 시작 오퍼레이터, 치유와 딜링 겸비, 일부 맵에 적합한 위치 존재 |
    | 무에나(玛恩纳) | 무에나, 실버애쉬 | 지상 광범위 결전 딜러, 보스 대응용 배치 가능 |
    | 수르트(史尔特尔) | 수르트 | 정예화 2 이후 3스킬 고정 장착으로 현장 유지 능력이 거의 없어 저지 위치에서의 배치 우선순위가 매우 낮음 |
    | 주사위(骰子) | 주사위 | 수월 로그라이크의 주사위는 별도 조작 필요 |

::: info 주의
현재 인식되지 않은 지상 오퍼레이터는 고정적으로 뒤에서 두 번째 그룹(기타 지상) 뒤에 배치되며, 인식되지 않은 고지대 오퍼레이터는 마지막 그룹(기타 고지대) 뒤에 배치됩니다
:::

::: tip
새로 실장된 오퍼레이터는 각 로그라이크의 `recruitment.json`에 수동으로 추가해야 하며, 개발자가 반드시 적용을 기억해서 추가한다고 보장할 수 없습니다 (?
만약 당신이 이 오퍼레이터의 사용에 익숙하고, 문서 내용과 기존 모집 방식을 잘 이해하며, 기여할 의사가 있다면 PR을 환영합니다
:::

### 프리셋 진형 - 진형 완성도 검사

여러분이 클리어할 수 있거나 상위 층까지 도달할 수 있다고 예상되는 팀에서, 어떤 오퍼레이터들이 기본 핵심 오퍼레이터군에 속하나요? 어떤 오퍼레이터들이 필수적이며, 각각 몇 명이 필요한가요?

::: info 주의사항
현재 스크립트의 모집 로직은 진형 완성도를 만족하지 않은 상태에서는 0 희망(현재는 3성 오퍼레이터만 해당)과 key(화이트리스트로 이해 가능) 오퍼레이터만 모집하며, 희망을 6성 key 오퍼레이터를 위해 저장합니다.
(현재 구현 방식은 강력한 오퍼레이터와 3성 오퍼레이터를 수동으로 key 오퍼레이터로 표시하고, 모집 시 key 오퍼레이터만 모집합니다) (TODO: 0 희망 오퍼레이터 식별)
강력한 오퍼레이터(예: Wiš'adel)는 여러 오퍼레이터 그룹에 속할 수 있으며, 진형 완성도 검사에서 한 명의 오퍼레이터가 여러 그룹에 존재하여 1 이상의 threshold 검사를 충족시킬 수 있습니다.
따라서 완성도 총합을 적절하게 유지해야 하며, 필요한 모든 오퍼레이터 수(기본 핵심 진형, 일반적으로 1 핵심, 2 지상, 1-2 힐러, 1 고지대)의 합이 4-8명 정도가 되도록 권장합니다.

팀이 진형 완성도 검사를 충족한 후에는 모집권을 얻을 때마다 오퍼레이터의 평가 점수와 정예화 2 우선순위에 따라 모집합니다. 따라서 희망 낭비를 피하기 위해 모집을 원하지 않는 오퍼레이터는 평가 점수를 설정하지 않거나 같은 직업군의 3성/예비 대원보다 낮게 설정할 수 있습니다.
(반드시 필요하거나 전혀 원하지 않는 오퍼레이터의 경우, 특별히 매우 높거나 낮은 점수를 부여할 수 있습니다. 자세한 내용은 `Sarkaz`의 `Wiš'adel`와 `마르셀` 참조)

작전 편성 시에는 먼저 오퍼레이터 선택 화면의 기본 정렬(위에서 아래로, 왼쪽에서 오른쪽으로)을 순서대로 읽고 저장합니다.
이 순서를 기반으로, 상대적 순서를 유지하면서 진형 완성도를 만족하는 오퍼레이터를 가장 먼저 나타나는 순서대로 앞으로 이동시킵니다. 이는 진형 완성도가 모두 충족되거나 진형 완성도를 만족하는 오퍼레이터가 없을 때까지 계속됩니다.
그 다음 예비 오퍼레이터를 맨 뒤로 이동시켜 새로운 순서를 만들고, 이 새로운 순서에 따라 선택합니다.
특별히, 6성 임시 모집 오퍼레이터는 편성 시 기본적으로 맨 앞에 위치하므로 실제 편성에서 6성 임시 모집 오퍼레이터가 쉽게 포함될 수 있습니다. (TODO: 사용 불가능한 정예화 1 임시 모집 오퍼레이터 제외)

신규 계정의 경우: 10번의 모집에서 절반의 key 오퍼레이터를 충족하지 못한 경우, 완성도 검사를 포기하고 평가 점수에 따라 가능한 모든 오퍼레이터를 사용합니다. 따라서 3성 오퍼레이터를 육성하지 않은 신규 계정에서는 2-3개의 6성 오퍼레이터만 얻고 나머지는 예비 대원들로 채워지는 상황이 발생할 수 있습니다.
:::

```json
{
    "theme": "Phantom",              // 로그라이크 테마
    "priority": [                    // 그룹
             ...
        ],
    "team_complete_condition": [     // 라인업 완성도 검사
        {
            "groups": [              // 필요한 그룹 멤버
                "C-team"
            ],
            "threshold": 1           // 필요한 오퍼레이터 수
        },                           // (이것은 C팀의 고지대 오퍼레이터이 필요하다는 것을 나타냅니다)
        {
            "groups": [
                "Thorns",              // (최소 2명의 오퍼레이터가 필요합니다 Thorns, GroundBlock, Ground1Block, Fodder)
                "GroundBlock",
                "Ground1Block",
                "Fodder"
            ],
            "threshold": 2
        },
        ...
        ]
}
```

### 오퍼레이터 모집 매개변수 조정

1. 그룹 내 오퍼레이터 순서는 해당 오퍼레이터 그룹을 작전 배치할 때 오퍼레이터 선택의 우선순위를 나타냅니다.

2. 임시 모집 오퍼레이터는 기존 평가 점수에 600점이 추가됩니다.

3. 랜덤 승급 오퍼레이터의 평가 점수는 모집 평가 점수와 2정 평가 점수를 합산하여 계산합니다.

4. 그룹 내 오퍼레이터 각 필드의 의미와 스크립트 관련 로직:

    ```json
    {
        "theme": "Phantom",
        "priority": [
            "name": "GroundBlocking",                                // 그룹명(여기서는 지상 저지 그룹)
            "doc": "기준선은 1등급(잡몹 처리 능력 또는 현장 유지 능력이 마운틴보다 강함)>마운틴>2등급(저지>2, 자가 회복 가능)>스팟, 현장 유지 능력이 스팟보다 작으면 단일 타겟 또는 캐논 포더 그룹으로",
                                                            // "doc" 필드는 모두 json 내 주석 문서로, 프로그램 실행에 영향을 주지 않습니다
            "opers": [                                        // 해당 그룹에 포함될 오퍼레이터들, 순서가 있으며 배치 우선순위를 나타냅니다
                {
                    "name": "가비알 디 인빈서블",                           // 오퍼레이터 이름(여기서는 가비알, 그룹 내 1위로, 지상 저지 그룹 배치 시 먼저 가비알인지 확인함을 의미)
                    "skill": 3,                               // 사용할 스킬 번호(여기서는 3스킬 사용)
                    "skill_usage": 2,                         // 스킬 사용 모드, 3-3 전투 흐름 프로토콜 참조, 미입력 또는 1은 자동 사용, 2는 x회만 사용("skill_times" 필드로 설정), 3은 현재 지원 안 함
                    "skill_times": 2,                         // 스킬 사용 횟수, 기본값 1, "skill_usage" 필드가 2일 때 적용
                    "alternate_skill": 2,                     // 지정된 스킬이 없을 때 사용할 대체 스킬, 주로 6성 오퍼레이터가 정예화 2가 아니고 정예화 2 후 3스킬 사용 시에만 지정 필요(여기서는 3스킬이 없을 때 2스킬 사용)
                    "alternate_skill_usage": 1                // 대체 스킬의 스킬 사용 모드(이 필드는 아직 구현되지 않음)
                    "alternate_skill_times": 1                // 대체 스킬의 스킬 사용 횟수(이 필드는 아직 구현되지 않음)
                    "recruit_priority": 900,                  // 모집 우선순위, 숫자가 클수록 우선순위 높음, 900 이상은 보이면 반드시 모집, 400 이하는 일부 핵심 오퍼레이터 정예화 2 우선순위보다 낮음
                                                            // 임시 모집 오퍼레이터의 우선순위는 자동으로 +600
                    "promote_priority": 600,                  // 승급 우선순위, 숫자가 클수록 우선순위 높음, 900 이상은 희망이 있으면 정예화 2, 400 이하는 일반 3성 오퍼레이터 모집 우선순위보다 낮음
                                                            // 팁: 모집 우선순위를 낮추거나 미입력하고 정예화 2 우선순위를 높이면, 실제로는 이 오퍼레이터들의 임시 모집 시 정예화 2 우선순위를 높이는 것
                    "is_key": true,                           // true는 key(핵심) 오퍼레이터, false 또는 생략은 비핵심 오퍼레이터. 진형 완성도 검사 미통과 시 key 오퍼레이터와 0 희망 오퍼레이터만 모집하여 희망 절약.
                    "is_start": true,                         // true는 시작 시 선택 오퍼레이터, false 또는 생략은 비시작 오퍼레이터. 팀에 start 오퍼레이터가 없을 때 start 오퍼레이터와 0 희망 오퍼레이터만 모집
                                                            // 사용자 그래픽 인터페이스의 시작 오퍼레이터와 연결되며, 사용자가 수동으로 입력한 오퍼레이터는 강제로 start 오퍼레이터로 설정됨
                    "auto_retreat": 0,                        // 배치 후 몇 초 뒤 자동 철수, 정수, 0보다 클 때 적용, 주로 특수 오퍼레이터와 투척 유닛용, 로그라이크는 보통 2배속이므로 스킬 지속 시간/2로 설정 권장
                    "recruit_priority_when_team_full": 850,   // 별도 설정 불필요, 진형 완성도 충족 시 모집 우선순위, 기본 모집 우선순위-100
                    "promote_priority_when_team_full": 850,   // 별도 설정 불필요, 진형 완성도 충족 시 승급 우선순위, 기본 정예화 2 우선순위+300
                    "recruit_priority_offsets": [             // 현재 진형에 따른 모집 우선순위 조정
                        {
                            "groups": [                       // 어떤 그룹들이 조건을 충족해야 하는지, 그룹별로 계산됨, 이 그룹들에 중복 오퍼레이터가 없어야 함, 그렇지 않으면 중복 계산됨
                                "Kaltsit",
                                "GroundBlocking",
                                "Thorns"
                            ],
                            "is_less": false,                 // 조건이 초과인지 미만인지, false는 이상, true는 이하, 미입력 시 기본값 false
                            "threshold": 2,                   // 조건을 충족하는 수량, 미입력 시 기본값 0
                            "offset": -300                    // 충족 시 모집 우선순위 조정, 미입력 시 기본값 0
                                                            // (여기서는 켈시, 지상 저지, 쏜 이 세 그룹 중 2명 이상의 오퍼레이터가 있을 때, 가비알의 모집 우선순위가 300 감소함을 의미)
                        }
                    ]
                },
                ...
            ],
        ],
        "team_complete_condition": [
            ...
        ]
    }
    ```

    ::: info 주의
    `recruit_priority_offsets`의 group 내 그룹에는 중복 오퍼레이터가 없어야 합니다.

    `auto_retreat`을 설정한 경우 일반적으로 작전 계획에서 해당 오퍼레이터에 대한 `retreat_plan`을 별도로 설정할 필요가 없습니다.
    :::

5. 그룹과 오퍼레이터를 필요에 따라 추가합니다.

    새로운 그룹을 추가할 때 기존 그룹에서 오퍼레이터를 복사할 수 있습니다. 개발자가 이미 부여한 평가를 참고하고, 이를 바탕으로 수정합니다.

## 통합 전략 2단계 - 전투 로직

`resource/roguelike/theme_name/autopilot/level_name.json` 은 각 레벨의 전투 전략을 설명합니다.

### MAA의 기본 로그라이크 전투 로직

1. 맵의 그리드 유형에 따라 기본 전투 작업 수행

    - MAA는 맵의 그리드가 목표 지점인지 적 출현 지점인지, 고지대인지 지상인지, 배치 가능한지 여부에 따라 기본 전투 작업을 수행합니다.

    - MAA는 맵 이름이나 번호를 기준으로 직업을 결정하며, 맵의 **표준**, **긴급**, **분기점**, **아이템 사용** 등의 상황을 판단하지 않습니다.

    - MAA는 전투 중 **맵의 정의되지 않은 그리드**을 판단하지 않습니다. 예를 들어, `Taming Hut`의 제단 위치, 왼쪽이나 오른쪽에서 나오는 몬스터의 `팔로워 효과` 등을 판단하지 않습니다.

    따라서 미래에는 **맵 이름의 모든 시나리오**에 대응할 수 있는 전투 로직을 설계해야 하며, 이 맵이 긴급 모드에서 작동하는 문제에 주의해야 합니다.

2. MAA의 기본 전투 전략 -- 목표 지점 진입 막기

    1. 지상 크루는 우선적으로 목표 지점 (그리드)를 중심으로 (또는 주변) 배치되며, 적 출현 지점을 향해 배치됩니다 (자동으로 계산됨). 적 출현 지점에는 배치되지 않습니다.

    2. 고지대보다 지상을 우선 배치하고, 목표 지점에서 주변으로 원형으로 배치됩니다.

    3. 위의 로직에 따라 배치할 수 있는 것들 (오퍼레이터, 소환물, 지원 아이템 등)을 계속 배치합니다.

### 기본 전투 전략 최적화

1. 목표 지점 대체

    목표 지점 앞에 오퍼레이터를 쌓는 것은 분명히 현명하지 않습니다. 일부 레벨에는 통과할 수 없는 그리드가 있으며, 이러한 위치에서는 방어가 매우 효율적입니다.

    또는 여러 목표 지점이 있는 레벨에서 MAA가 어떤 목표 지점가 어떤 적 출현 지점와 대응되는지 모를 경우, 무작위로 배치할 수 있습니다.

    이 경우 [map wiki](https://map.ark-nights.com/areas?coord_override=maa)를 열고 전투를 상상하면서 방어해야 할 우선순위 그리드와 방향을 찾아 `replacement_home`에 작성합니다.

    이 링크를 사용하세요. 그렇지 않으면 `설정`에서 `좌표 표시`를 `MAA`로 전환하세요.

    그런 다음, 경험을 바탕으로 방어 우선순위가 필요한 지점의 좌표와 방향을 찾아 json의 `replacement_home`에 작성하세요.

    ```json
    {
        "stage_name": "蓄水池",        // 레벨 이름 (중국어)
        "replacement_home": [         // 진입 지점 (목표 지점 대체 지점),
                                    // 최소 1개 이상이어야 완전합니다.
            {
                "location": [         // 그리드 좌표, 맵 위키에서 얻을 수 있음
                    6,
                    4
                ],
                "direction_Doc1": "선호 방향, 반드시 해당 방향이라는 의미는 아님 (알고리즘이 자체적으로 판단함)",
                "direction_Doc2": "기본값은 없음, 즉 추천 방향이 없으며, 완전히 알고리즘에 의해 결정됨",
                "direction_Doc3": "none / left / right / up / down / 无 / 上 / 下 / 左 / 右",
                "direction": "left"   // (이것은 그리드 6,4에서 왼쪽으로 오퍼레이터를 우선 배치함을 나타냅니다.)
            }
        ],
        ...
    ```

    ::: tip
    방어 포인트 대체 방안은 `deploy_plan`이 모두 완료되었지만 대기 배치 구역에 여전히 오퍼레이터가 있는 경우에 적용됩니다. 로직은 일반 작전 전략과 동일합니다.
    :::

2. 배치 그리드 블랙리스트

    방어를 우선해야 할 지점과 오퍼레이터를 배치하지 않아야 할 지점이 있습니다. 예를 들어 화염구가 지나가는 곳, 보스의 발 밑, 배치하기 좋지 않은 위치 등입니다.

    이 경우 `blacklist_location`을 도입하여 MAA가 오퍼레이터를 배치하지 않도록 그리드를 블랙리스트에 추가합니다.

    ::: info
    여기에 추가된 그리드는 나중에 배치 전략에 포함되더라도 배치되지 않습니다.
    :::

    ```json
        ...
        "blacklist_location_Doc": "이것은 사용 예시이며, 맵 '蓄水池'가 필요로 하는 것은 아님.",
        "blacklist_location": [ // 오퍼레이터 배치 금지 위치
            [
                0,
                0
            ],
            [
                1,
                1
            ]
        ],
    ```

3. 대체 맵 전략

    예를 들어, 미즈키 로그라이크에서 방어 포인트에 몬스터가 있다면 주사위를 사용하여 몬스터 쌓이는 상황을 완화할 수 있습니다.

    ```json
        "not_use_dice_Doc": "방어 포인트 오퍼레이터 철수 시 주사위를 사용할 필요가 있는지, 미입력 시 기본값 false",
        "not_use_dice": false,
    ```

### 이제 긴급 작전인가요? 이제 진정한 실력을 발휘할 때에요! - 맞춤형 전투 전략

`"deploy_plan"` 및 `"retreat_plan"`을 사용하여 맞춤 설정

맞춤형 전략은 기본 전투 전략보다 우선하며, 맞춤형 전략의 모든 단계를 시도한 후 저장되거나 퇴각한 오퍼레이터가 기본 전투 전략에 따라 배치됩니다.

문제가 발생했을 때 맞춤형 계획을 너무 많이 설정할 필요는 없습니다. 중요한 단계를 완료한 후 MAA에 맡기거나 둘 다 결합하는 것이 더 나을 수 있습니다.

1. 그룹을 사용하여 오퍼레이터 배치

    ```json
    "deploy_plan": [ // 배치 로직: 위에서 아래로, 왼쪽에서 오른쪽으로 순서대로
                    // 첫 번째 오퍼레이터를 찾고, 찾지 못하면 건너뜁니다.
        {

            "groups": ["GavialAlter", "Mudrock", "GroundC", "Horn", "Vanguard"], // 이 그룹에서 오퍼레이터를 찾습니다.
            "location": [ 6, 4 ],                     // 첫 번째 오퍼레이터을 그리드 6,4에 배치하고 왼쪽을 향합니다.
            "direction": "left",                      // 찾지 못하면 다음 배치 작업으로 넘어갑니다.
        },
        {
            "groups": [ "Summoner" ],
            "location": [ 6, 3 ],
            "direction": "left"
        },
        {
            "groups": [ "单奶", "群奶" ],
            "location": [ 6, 2 ],
            "direction": "down"
        }
    ]
    ```

    ::: info 주의
    MAA는 모든 배치 명령을 평탄화한 후 가장 높은 우선순위 배치 작업을 실행합니다.
    예: [6,4]에 ["가비알(百嘉)", "기간(基石)", "지상 C(地面 C)"]를 배치하고, [6,3]에 ["기간(基石)", "지상 C(地面 C)"]를 배치하면, MAA는 배치 지시를 좌표가 포함된 ["가비알(百嘉)", "기간(基石)", "지상 C(地面 C)", "기간(基石)", "지상 C(地面 C)"]로 평면화합니다.
    만약 전투 중 [6,4] 위치의 "가비알(百嘉)" 그룹 오퍼레이터가 쓰러지고, 배치 가능한 "기간(基石)" 그룹 오퍼레이터가 있다면, [6,3]이 아닌 [6,4]에 우선 배치됩니다.

    이는 거시적으로 볼 때, 배치 동작을 완료할 때마다 실행 가능한 전략을 처음부터 다시 검사함을 의미합니다(현재 단계의 위치에 이미 배치된 오퍼레이터가 없고, 대기 배치 구역에 이 단계의 오퍼레이터 그룹에 속하는 오퍼레이터가 있는 경우)
    :::

    ::: tip
    자주 사용되는 오퍼레이터 그룹 사용법:

    1. 많은 작전에서 주요 방어 지점의 조합은 ["지상 저지(地面阻挡)", "처형자(处决者)", "기타 지상(其他地面)"]입니다. 이는 주요 탱킹 위치의 오퍼레이터가 사망했을 때 처형자로 쿨다운을 지연시키려 시도함을 의미합니다. 이 지점의 생존 압박이 너무 높을 때는 ["중장갑(重装)", "지상 저지(地面阻挡)", "처형자(处决者)", "캐논 포더(炮灰)", "기타 지상(其他地面)"]을 고려하세요. 탱커 뒤 지점은 탱커 뒤 딜러를 우선할 수 있습니다 ["지상 원거리(地面远程)", "지상 저지(地面阻挡)", "처형자(处决者)", "기타 지상(其他地面)"]. 단순히 적대심을 끌거나 희생용으로는 ["캐논 포더(炮灰)", "장애물(障碍物)", "기타 지상(其他地面)"]을 사용할 수 있습니다.

    2. 고지대 위치 조합으로는 주로 ["고지대 딜러(高台输出)", "기타 고지대(其他高台)"]를 사용합니다. 어떤 고지대 오퍼레이터든 배치하고 싶다면 ["고지대 딜러(高台输出)", "명사수(狙击)", "서포터(辅助)", "실드 마법사(盾法)", "기타 고지대(其他高台)"]를 사용할 수 있습니다.

    3. 일부 지상 위치에는 실버애쉬와 쏜즈류 오퍼레이터가 모두 적합합니다 ["무에나(玛恩纳)", "쏜즈(地刺)"]
       :::

2. 특정 시간에 오퍼레이터 배치
   ::: tip
   특정 단일 절단 오퍼레이터나 포드가 필요한 사용 시나리오에 적합합니다.
   :::

    ```json
    "deploy_plan": [
            {
                "groups": [ "StrangeVirtue", "Assassin", "Vanguard", "OtherFloors" ],
                "location": [ 5, 3 ],
                "direction": "left",
                "condition": [ 0, 3 ]   // 처치 수가 0 - 3일 때만 이 작업을 수행합니다.
            },
            {
                "groups": [ "StrangeVirtue", "Assassin", "Vanguard", "OtherFloors" ],
                "location": [ 5, 3 ],
                "direction": "left",
                "condition": [ 6, 10 ]
            },
            ...
        ]
    ```

3. 특정 시점에 오퍼레이터 철수하기
   ::: tip
   때로는 캐논 포더(炮灰)가 너무 강해서 자리를 지키거나, 배치 위치를 확보하기 위해 진형을 조정해야 할 때는 어떻게 해야 할까요? 철수하세요!

    같은 위치의 배치와 철수 명령의 condition 숫자는 가능한 한 겹치지 않도록 하세요. 그렇지 않으면 배치와 철수가 순식간에 반복될 수 있습니다.
    :::

    ```json
    "retreat_plan": [                  // 특정 시간에 오퍼레이터 퇴각 대상
            {
                "location": [ 4, 1 ],
                "condition": [ 7, 8 ]   // 처치 수가 7 - 8일 때 [4,1]에 있는 오퍼레이터를 제거합니다. 없으면 건너뜁니다.
            }
        ]
    ```

4. 특정 시간에 스킬 비활성화 (_TODO_)

5. 추가 필드 (권장하지 않음)

    ```json
        "role_order_Doc": "오퍼레이터 유형 배치 순서, 지정되지 않은 부분은 Guard, Vanguard, Medic, Defender, Sniper, Caster, Supporter, Specialist, Summoner 순서로 채워집니다.",
        "role_order": [                 // 권장하지 않음, deploy_plan 필드를 구성하세요.
            "warrior",
            "pioneer",
            "medic",
            "tank",
            "sniper",
            "caster",
            "support",
            "special",
            "drone"
        ],
        "force_air_defense_when_deploy_blocking_num_Doc": "필드에 10000개의 블록 유닛이 있을 때 강제적으로 총 1쌍의 공중 유닛을 배치합니다 (기본 배치 로직에는 영향을 미치지 않음), 이 기간 동안 의료 유닛 배치는 금지되지 않습니다 (기본값은 false).",
        "force_air_defense_when_deploy_blocking_num": { // 권장하지 않음, deploy_plan 필드를 구성하세요.
            "melee_num": 10000,
            "air_defense_num": 1,
            "ban_medic": false
        },
        "force_deploy_direction_Doc": "특정 직업에 대한 강제 배치 방향",
        "force_deploy_direction": [     // 권장하지 않음, deploy_plan 필드를 구성하세요.
            {
                "location": [
                    1,
                    1
                ],
                "role_Doc": "입력된 직업에 대한 강제 배치 방향 적용",
                "role": [
                    "warrior",
                    "pioneer"
                ],
                "direction": "up"
            },
            {
                "location": [
                    3,
                    1
                ],
                "role": [
                    "sniper"
                ],
                "direction": "left"
            }
        ],
    ```

### 특정 오퍼레이터의 플레이 스타일에 대해 특별한 이해가 있나요? - 특정 오퍼레이터의 정밀 조작

이 오퍼레이터를 별도로 그룹화해 주세요.

작전을 작성할 때 이 오퍼레이터와 기존 작전의 우선순위를 고려해 주세요.

그렇게 많이 고려하지 않고, 이 오퍼레이터만을 위한 별도의 전투 로직을 작성할 수도 있습니다.

단 한 명의 오퍼레이터만 사용하는 것도 가능합니다! MAA를 사용하여 솔로 클리어에 도전해 보세요 (다른 로직의 불완전성으로 인해 성공 가능성은 매우 낮습니다).

참고 예시: 1. 팬텀 로그라이크의 Wiš'adel, 2. 미즈키 로그라이크의 Wiš'adel, 3. 사미 로그라이크의 Wiš'adel, 4. 살카즈 로그라이크의 Wiš'adel

## 통합 전략 단계 3: 조우 노드 로직

`resource/roguelike/theme_name/encounter/default.json` 레벨링 모드에서 조우 이벤트 선택에 대한 전략

`resource/roguelike/theme_name/encounter/deposit.json` 투자 모드에서 조우 이벤트 선택에 대한 전략

### MAA의 현재 우연한 조우 판단 방법

OCR로 우연한 조우 이벤트 이름을 인식하지만, 선택지는 고정된 위치를 조작합니다.

이벤트 이름 인식에 실패할 경우, 선택지 유형 아이콘(있는 경우)을 클릭하거나 가장 아래의 선택지를 클릭합니다.

흔한 멈춤 현상의 원인 중 하나는 선택지 유형의 아이콘은 존재하지만 선택지를 선택할 수 없는 경우입니다 (TODO)

로그라이크 로직을 개선할 때는 일반적으로 약간의 조정만 하거나 조정하지 않아도 됩니다 (전문가들이 이미 잘 작성해 놓았으니까요)

### 조우 옵션의 우선순위 최적화

각 조우 옵션의 효과를 확인하려면 [prts.wiki](https://prts.wiki/w/%E9%9B%86%E6%88%90%E6%88%98%E7%95%A5)를 참조하세요. 옵션이 반드시 고정되지 않습니다.

조우 옵션을 수정하여 MAA가 특별한 결말로 향하도록 유도할 수 있습니다.

```json
{
    "theme": "Sami",                              // 로그라이크 테마
    "stage": [                                    // 조우 이벤트
        {
            "name": "低地市集",                    // 조우 이름
            "option_num": 3,                      // 총 몇 개의 옵션이 있는지 (이 경우: 3)
            "choose": 3,                          // 어떤 옵션을 먼저 선택해야 하는지 (여기서는 세 번째 옵션을 우선 선택함)
                                                  // 선택할 수 없으면 도주 옵션을 선택합니다 (기본적으로 마지막 옵션)

            "choice_require": [                   // 옵션 선택 요구 사항
                                                  // (프로그램 운영에는 영향을 미치지 않음
                                                  // 적용 가능한 상황만 표시하여 수정하기 쉽게 함)
                {
                    "name": "选择碎草药",          // 옵션 이름
                    "ChaosLevel": {               // 면역 / 가벼운 수준
                        "value": "3",             // 필요한 수
                        "type": ">"               // 초과인지 미만인지
                                                  //(여기서는 면역 / 가벼운 수준이 3을 초과하는 경우만
                                                  // "약초 선택" 옵션이 활성화됨)
                    }
                },
                {
                    "name": "选择好看的织物",
                    "ChaosLevel": {
                        "value": "3",
                        "type": ">"
                    }
                },
                ...
```

### 팀 상황에 따라 특정 옵션의 우선순위 동적으로 설정 (_TODO_)

## 통합 전략 단계 4: 무역 상점 수집 우선순위

`resource/roguelike/theme_name/shopping.json` 상점에서 수집품 구매에 대한 전략을 설명 (전투 후 수집품 선택?)

```json
{
    "theme": "Phantom",                                       //로그라이크 테마 이름 (여기서는 팬텀)
    "priority": [                                             //우선순위, 순서대로, 순서가 곧 우선순위, 앞쪽일수록 구매 우선순위가 높음,
                                                              //하지만 우선순위 판단은 chars, roles의 필터링 전에 이루어져, 높은 우선순위 상품이 필터링되어 아무것도 구매하지 않는 상황이 발생할 수 있음
        {
            "name": "황금 술의 성배(金酒之杯)",                      //수집품 이름 (여기서는 황금 술의 성배)
            "no_longer_buy": true,                             //true는 이 수집품을 얻은 후 더 이상 수집품에 돈을 쓰지 않음을 의미, false 또는 생략은 계속 수집품에 돈을 씀을 의미
            "ignore_no_longer_buy": true,                      //true는 상점에 이 수집품이 있을 때 "no_longer_buy"를 무시하고 구매함을 의미, false 또는 생략은 "no_longer_buy"가 있는 수집품을 얻은 후 이 수집품을 구매하지 않음을 의미
            "effect": "오리지늄 조각 5개당 모든 아군 유닛의 공격 속도 +7",  //수집품 효과 (프로그램 실행에 영향을 주지 않으며, 정렬을 위한 효과 메모)
            "no": 167                                          //수집품 번호, 위키에서 확인 가능 (프로그램 실행에 영향을 주지 않으며, 정렬을 위한 메모)
        },

        ...
        {
            "name": "확장의 손(扩散之手)",
            "chars": [                                         //팀에 이 오퍼레이터들이 있을 때 이 수집품을 구매
                "팬텀(异客)"                                    //(여기서는 팀에 팬텀이 있을 때, 확산의 손을 만나면 구매를 시도함을 의미)
            ],
            "effect": "【확산 캐스터】, 【체인 캐스터】, 【폭격 캐스터】가 유닛에 데미지를 줄 때마다 2 기력 회복",
            "no": 136
        },
        ...

        {
            "name": "브로큰스피어-임전무퇴(折戟-破釜沉舟)",
            "roles": [                                         //팀에 이 직업들이 있을 때 이 수집품을 구매
                "WARRIOR"                                      //(여기서는 팀에 근위 오퍼레이터가 있을 때, 절창-파부침주를 만나면 구매를 시도함을 의미)
            ],
            "effect": "모든 【가드】 오퍼레이터의 방어력 -40%, 하지만 공격력 +40%, 공격 속도 +30",
            "no": 16
        },
        ...

        {
            "name": "미스 크리스틴 쓰담권(Miss.Christine摸摸券)",
            "promotion": 2,                                   //팀에 승급이 필요한 오퍐이터 2명이 있을 때 구매 (아마도?)
            "effect": "즉시 두 오퍼레이터 승급 (희망 소모 없음)",
            "no": 15
        },
        ...

        {
            "name": "경계용 울타리(警戒篱木)",
            "effect": "붕괴 값 -2, 대상 최대 체력 +2",
            "No": 198,
            "decrease_collapse": true                          // true는 이 수집품을 얻으면 붕괴 값이 감소함을 나타냅니다. mode가 5일 때는 구매하지 않습니다.
        },
        ...

    "others":                                                  // maa가 구매하지 않을 수집품들, 예를 들어 엔딩 수집품과 크레인
        {
            "name": "무인 크레인(无人起重机)"
        },
```

### 사미 로그라이크 - 붕괴 패러다임

`check_collapsal_paradigms`가 `true`일 때, MAA는 두 가지 다른 방법으로 붕괴 패러다임을 확인합니다:

- 선택 화면에서 화면 중앙 상단을 클릭하여 붕괴 상태 바를 펼칩니다. 이하 Panel Check라고 합니다.
- 화면 오른쪽에 붕괴 패러다임 알림이 있는지 관찰합니다. 이하 Banner Check라고 합니다.

붕괴 값을 얻는 방법은 다양하며, 다음과 같은 상황을 고려했습니다:

1. 전투 후 완벽하지 않은 전투로 인해 붕괴 값이 증가할 때, Banner Check를 수행합니다.
2. 전투 후 수집품 획득으로 붕괴 값이 변동될 때, Banner Check를 수행합니다.
3. 우연한 조우 등의 노드에서 선택지로 인해 붕괴 값이 변동될 때, Banner Check를 수행합니다.
4. 기괴한 행상인 노드에서 수집품 구매로 인해 붕괴 값이 변동될 때, Banner Check를 수행합니다.
5. 암호판 사용으로 붕괴 값이 감소할 때, Banner Check를 수행합니다.
6. 새로운 층에 진입하여 붕괴 값이 증가할 때, Panel Check를 수행합니다.
7. Banner Check 수행 시 붕괴 패러다임이 소멸되었음을 발견하면, 한 번에 두 단계가 소멸될 수 있는지 확실하지 않기 때문에(가능성은 매우 낮지만), 다음에 선택 화면으로 돌아갈 때 추가로 Panel Check를 한 번 더 수행합니다.
8. `double_check_collapsal_paradigms`가 `true`일 경우, 선택 화면으로 돌아갈 때마다 추가로 Panel Check를 수행하여 이전에 붕괴 패러다임을 놓치거나 과도하게 기록하지 않았는지 확인합니다.

다음은 숨겨진 붕괴 패러다임을 파밍하기 위한 작업 설정 예시입니다:

```json
{
    "theme": "Sami",
    "mode": 5,
    "investment_enabled": false,
    "squad": "원거리 전술 분대",
    "roles": "차근차근",
    "core_char": "Wiš`adel",
    "expected_collapsal_paradigms": ["선택적 무시", "안하무인", "이미지 에러", "블랙아웃"]
}
```

`mode`가 `5`일 때:

- `stage_name`이 `관문 이름_collapse`인 전투 전략을 우선 사용합니다. 예: `resource/roguelike/Sami/autopilot/사사불과사_collapse.json`
- `resource/roguelike/Sami/encounter/collapse.json`에 설명된 우연한 조우 이벤트 선택 전략을 사용합니다.
- `decrease_collapse`가 `true`인 수집품은 구매하지 않습니다.

`mode`가 `5`가 아니지만 `check_collapsal_paradigms`가 `true`일 때, 여전히 붕괴 패러다임을 감지하고 `expected_collapsal_paradigms` 목록의 붕괴 패러다임을 만났을 때 작업을 중지하지만, 다른 붕괴 패러다임을 만났을 때는 재시작하지 않습니다.

숨겨진 붕괴 패러다임을 파밍할 때는 N10 난이도를 추천하며, 다음 팀 구성을 제안합니다:

- Wiš'adel + 스팟 + 스튜어트
- 리드 더 플레임 섀도우 + 오키드 + 포푸카
- 티폰 + 스팟 + 스튜어트

## 구현하고자 하는 로직 (TODO)

### 자동 편성 로직

1. 다른 맵에 따라 다른 맵 진형 완성도 검사와 스킬 우선순위 설정 가능

2. 현재 진형에 따라 난이도가 높은 일부 전투 회피 가능

### ~~경로 탐색 알고리즘 최적화~~ (초기 구현 완료)

예를 들어, 앞의 세 층에서는 더 많은 전투를, 뒷부분에서는 적은 전투를 하도록 구현하여 더 나은 육성이 가능하게 함

예를 들어, 노드 간 연결선을 인식하여 더 최적의 경로 판단

### 스킬 유지

특정 위치에 배치된 오퍼레이터의 스킬이 준비되면 x초 후에 사용하도록 하여 타이밍 조절 가능; Deploy_plan 아래의 Skill_hold에 작성하거나 Skill_hold_plan에 작성 가능

### 스킬 종료

탄약 타입 오퍼레이터에게 유용

<!-- markdownlint-disable-file MD026 -->
